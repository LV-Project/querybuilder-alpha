package com.latam.jala;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonNode;
import com.latam.jala.pojos.request.Args;
import com.latam.jala.pojos.request.IncomingData;
import com.latam.jala.pojos.request.Params;
import com.latam.jala.queryBuilder.QueryBuilder;
import com.latam.jala.serializer.Json;

import java.util.ArrayList;
import java.util.List;

public class app {
    public static void main(String[] args) throws JsonProcessingException {

        String json ="{\"params\":{\"questions\":[{\"question\":\"what is the most repeated publication title\",\"input_args\":[],\"output\":[\"title\",\"type\"]},{\"question\":\"show me the top ten of most repeated publication title filtered by Print book and ordered in descendant mode by frequency\",\"input_args\":[{\"name\":\"type\",\"value\":\"Print book\"},{\"name\":\"limit\",\"value\":10}],\"output\":[\"title\",\"frequency\"]}]}}";

//            JsonNode node = Json.parse(json);
//            Params inputJson = Json.fromJson(node, Params.class);
//
//            for (IncomingData in : inputJson.getParams().getQuestions()){
//                System.out.println(in.getQuestion());
//
//                for(Args at: in.getInput_args()){
//                    System.out.println(at.getName() + " = " + at.getValue());
//                }
//
//                for(String on : in.getOutput()){
//                    System.out.println(on);
//                }
//
//                //QueryBuilder qB = new QueryBuilder();
//                //System.out.println(qB.queryConstructor(in)+"\n");
//            }

        String example = "{\"sessionId\":\"077492956248341\",\"inputTranscript\":\"Iwantallthetitlesprintbookpublishedin2021\",\"interpretations\":[{\"intent\":{\"slots\":{\"output\":{\"shape\":\"List\",\"value\":{\"originalValue\":\"titles\",\"resolvedValues\":[\"title\"],\"interpretedValue\":\"title\"},\"values\":[{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"titles\",\"resolvedValues\":[\"title\"],\"interpretedValue\":\"title\"}}]},\"ArgsTwo\":null,\"Args\":{\"shape\":\"List\",\"value\":{\"originalValue\":\"printbookand2021\",\"resolvedValues\":[\"PrintbookanddateEdition=2021\"],\"interpretedValue\":\"PrintbookanddateEdition=2021\"},\"values\":[{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"printbook\",\"resolvedValues\":[\"Printbook\"],\"interpretedValue\":\"Printbook\"}},{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"2021\",\"resolvedValues\":[\"dateEdition=2021\"],\"interpretedValue\":\"dateEdition=2021\"}}]}},\"confirmationState\":\"None\",\"name\":\"Query\",\"state\":\"ReadyForFulfillment\"},\"nluConfidence\":0.8},{\"intent\":{\"slots\":{},\"confirmationState\":\"None\",\"name\":\"FallbackIntent\",\"state\":\"ReadyForFulfillment\"}},{\"intent\":{\"slots\":{\"name\":null,\"greet\":{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"titlesprintbook2021\",\"resolvedValues\":[\"titles\"],\"interpretedValue\":\"titles\"}}},\"confirmationState\":\"None\",\"name\":\"Greetings\",\"state\":\"ReadyForFulfillment\"},\"nluConfidence\":0.48}],\"responseContentType\":\"text/plain;charset=utf-8\",\"invocationSource\":\"FulfillmentCodeHook\",\"messageVersion\":\"1.0\",\"transcriptions\":[{\"resolvedContext\":{\"intent\":\"Query\"},\"transcription\":\"Iwantallthetitlesprintbookpublishedin2021\",\"resolvedSlots\":{\"output\":{\"shape\":\"List\",\"value\":{\"originalValue\":\"titles\",\"resolvedValues\":[\"title\"]},\"values\":[{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"titles\",\"resolvedValues\":[\"title\"]}}]},\"Args\":{\"shape\":\"List\",\"value\":{\"originalValue\":\"printbookand2021\",\"resolvedValues\":[\"PrintbookanddateEdition=2021\"]},\"values\":[{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"printbook\",\"resolvedValues\":[\"Printbook\"]}},{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"2021\",\"resolvedValues\":[\"dateEdition=2021\"]}}]}},\"transcriptionConfidence\":1}],\"sessionState\":{\"originatingRequestId\":\"4577f7ff-a296-46d4-97da-6afc24491461\",\"intent\":{\"slots\":{\"output\":{\"shape\":\"List\",\"value\":{\"originalValue\":\"titles\",\"resolvedValues\":[\"title\"],\"interpretedValue\":\"title\"},\"values\":[{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"titles\",\"resolvedValues\":[\"title\"],\"interpretedValue\":\"title\"}}]},\"ArgsTwo\":null,\"Args\":{\"shape\":\"List\",\"value\":{\"originalValue\":\"printbookand2021\",\"resolvedValues\":[\"PrintbookanddateEdition=2021\"],\"interpretedValue\":\"PrintbookanddateEdition=2021\"},\"values\":[{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"printbook\",\"resolvedValues\":[\"Printbook\"],\"interpretedValue\":\"Printbook\"}},{\"shape\":\"Scalar\",\"value\":{\"originalValue\":\"2021\",\"resolvedValues\":[\"dateEdition=2021\"],\"interpretedValue\":\"dateEdition=2021\"}}]}},\"confirmationState\":\"None\",\"name\":\"Query\",\"state\":\"ReadyForFulfillment\"}},\"inputMode\":\"Text\",\"bot\":{\"aliasId\":\"TSTALIASID\",\"aliasName\":\"TestBotAlias\",\"name\":\"Node-leo-bot\",\"version\":\"DRAFT\",\"localeId\":\"en_US\",\"id\":\"MGKMW2E0VA\"}}";
        String example2 = "{\n    \"sessionId\": \"077492956248341\",\n    \"inputTranscript\": \"I want all the titles print book published in 2021\",\n    \"interpretations\": [\n        {\n            \"intent\": {\n                \"slots\": {\n                    \"output\": {\n                        \"shape\": \"List\",\n                        \"value\": {\n                            \"originalValue\": \"titles\",\n                            \"resolvedValues\": [\n                                \"title\"\n                            ],\n                            \"interpretedValue\": \"title\"\n                        },\n                        \"values\": [\n                            {\n                                \"shape\": \"Scalar\",\n                                \"value\": {\n                                    \"originalValue\": \"titles\",\n                                    \"resolvedValues\": [\n                                        \"title\"\n                                    ],\n                                    \"interpretedValue\": \"title\"\n                                }\n                            }\n                        ]\n                    },\n                    \"ArgsTwo\": null,\n                    \"Args\": {\n                        \"shape\": \"List\",\n                        \"value\": {\n                            \"originalValue\": \"print book and 2021\",\n                            \"resolvedValues\": [\n                                \"Print book and dateEdition = 2021\"\n                            ],\n                            \"interpretedValue\": \"Print book and dateEdition = 2021\"\n                        },\n                        \"values\": [\n                            {\n                                \"shape\": \"Scalar\",\n                                \"value\": {\n                                    \"originalValue\": \"print book\",\n                                    \"resolvedValues\": [\n                                        \"Print book\"\n                                    ],\n                                    \"interpretedValue\": \"Print book\"\n                                }\n                            },\n                            {\n                                \"shape\": \"Scalar\",\n                                \"value\": {\n                                    \"originalValue\": \"2021\",\n                                    \"resolvedValues\": [\n                                        \"dateEdition = 2021\"\n                                    ],\n                                    \"interpretedValue\": \"dateEdition = 2021\"\n                                }\n                            }\n                        ]\n                    }\n                },\n                \"confirmationState\": \"None\",\n                \"name\": \"Query\",\n                \"state\": \"ReadyForFulfillment\"\n            },\n            \"nluConfidence\": 0.8\n        },\n        {\n            \"intent\": {\n                \"slots\": {},\n                \"confirmationState\": \"None\",\n                \"name\": \"FallbackIntent\",\n                \"state\": \"ReadyForFulfillment\"\n            }\n        },\n        {\n            \"intent\": {\n                \"slots\": {\n                    \"name\": null,\n                    \"greet\": {\n                        \"shape\": \"Scalar\",\n                        \"value\": {\n                            \"originalValue\": \"titles print book 2021\",\n                            \"resolvedValues\": [\n                                \"titles\"\n                            ],\n                            \"interpretedValue\": \"titles\"\n                        }\n                    }\n                },\n                \"confirmationState\": \"None\",\n                \"name\": \"Greetings\",\n                \"state\": \"ReadyForFulfillment\"\n            },\n            \"nluConfidence\": 0.48\n        }\n    ],\n    \"responseContentType\": \"text/plain; charset=utf-8\",\n    \"invocationSource\": \"FulfillmentCodeHook\",\n    \"messageVersion\": \"1.0\",\n    \"transcriptions\": [\n        {\n            \"resolvedContext\": {\n                \"intent\": \"Query\"\n            },\n            \"transcription\": \"I want all the titles print book published in 2021\",\n            \"resolvedSlots\": {\n                \"output\": {\n                    \"shape\": \"List\",\n                    \"value\": {\n                        \"originalValue\": \"titles\",\n                        \"resolvedValues\": [\n                            \"title\"\n                        ]\n                    },\n                    \"values\": [\n                        {\n                            \"shape\": \"Scalar\",\n                            \"value\": {\n                                \"originalValue\": \"titles\",\n                                \"resolvedValues\": [\n                                    \"title\"\n                                ]\n                            }\n                        }\n                    ]\n                },\n                \"Args\": {\n                    \"shape\": \"List\",\n                    \"value\": {\n                        \"originalValue\": \"print book and 2021\",\n                        \"resolvedValues\": [\n                            \"Print book and dateEdition = 2021\"\n                        ]\n                    },\n                    \"values\": [\n                        {\n                            \"shape\": \"Scalar\",\n                            \"value\": {\n                                \"originalValue\": \"print book\",\n                                \"resolvedValues\": [\n                                    \"Print book\"\n                                ]\n                            }\n                        },\n                        {\n                            \"shape\": \"Scalar\",\n                            \"value\": {\n                                \"originalValue\": \"2021\",\n                                \"resolvedValues\": [\n                                    \"dateEdition = 2021\"\n                                ]\n                            }\n                        }\n                    ]\n                }\n            },\n            \"transcriptionConfidence\": 1\n        }\n    ],\n    \"sessionState\": {\n        \"originatingRequestId\": \"4577f7ff-a296-46d4-97da-6afc24491461\",\n        \"intent\": {\n            \"slots\": {\n                \"output\": {\n                    \"shape\": \"List\",\n                    \"value\": {\n                        \"originalValue\": \"titles\",\n                        \"resolvedValues\": [\n                            \"title\"\n                        ],\n                        \"interpretedValue\": \"title\"\n                    },\n                    \"values\": [\n                        {\n                            \"shape\": \"Scalar\",\n                            \"value\": {\n                                \"originalValue\": \"titles\",\n                                \"resolvedValues\": [\n                                    \"title\"\n                                ],\n                                \"interpretedValue\": \"title\"\n                            }\n                        }\n                    ]\n                },\n                \"ArgsTwo\": null,\n                \"Args\": {\n                    \"shape\": \"List\",\n                    \"value\": {\n                        \"originalValue\": \"print book and 2021\",\n                        \"resolvedValues\": [\n                            \"Print book and dateEdition = 2021\"\n                        ],\n                        \"interpretedValue\": \"Print book and dateEdition = 2021\"\n                    },\n                    \"values\": [\n                        {\n                            \"shape\": \"Scalar\",\n                            \"value\": {\n                                \"originalValue\": \"print book\",\n                                \"resolvedValues\": [\n                                    \"Print book\"\n                                ],\n                                \"interpretedValue\": \"Print book\"\n                            }\n                        },\n                        {\n                            \"shape\": \"Scalar\",\n                            \"value\": {\n                                \"originalValue\": \"2021\",\n                                \"resolvedValues\": [\n                                    \"dateEdition = 2021\"\n                                ],\n                                \"interpretedValue\": \"dateEdition = 2021\"\n                            }\n                        }\n                    ]\n                }\n            },\n            \"confirmationState\": \"None\",\n            \"name\": \"Query\",\n            \"state\": \"ReadyForFulfillment\"\n        }\n    },\n    \"inputMode\": \"Text\",\n    \"bot\": {\n        \"aliasId\": \"TSTALIASID\",\n        \"aliasName\": \"TestBotAlias\",\n        \"name\": \"Node-leo-bot\",\n        \"version\": \"DRAFT\",\n        \"localeId\": \"en_US\",\n        \"id\": \"MGKMW2E0VA\"\n    }\n}";
        JsonNode node = Json.parse(example2);
        JsonNode node1 = node.path("inputTranscript");
        JsonNode node2 = node.path("interpretations");

        List<JsonNode> nodes = new ArrayList<>();

        for (final JsonNode element : node2){
            nodes.add(element);
        }

        JsonNode queryData = nodes.get(0).path("intent").get("slots");

        System.out.println(node1);
        System.out.println(queryData.path("output").path("value").get("interpretedValue"));
        System.out.println(queryData.path("ArgsTwo").path("value").get("interpretedValue"));
        System.out.println(queryData.path("Args").path("value").get("interpretedValue"));

    }
}
